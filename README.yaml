name: Terraform AWS SSM Session Management Module
#logo: logo/logo.jpg

license: "APACHE2"

copyrights:
  - name: "Cloud Ops Works LLC"
    url: "https://cloudops.works"
    year: "2024"

github_repo: cloudopsworks/terraform-module-aws-ssm-session-management

description: |-
  This module sets up AWS SSM Session Manager settings, including S3 bucket for audit logs, CloudWatch Log Group, and KMS encryption for both.

# Introduction to the project
introduction: |-
  The AWS SSM Session Management module provides a standardized way to configure Session Manager across an organization.
  It ensures that all sessions are logged to a secure S3 bucket and optionally to CloudWatch Logs, with all data encrypted using a KMS key.

# How to use this project
usage: |-
  To use this module in a Terragrunt configuration:
  ```hcl
  terraform {
    source = "git::https://github.com/cloudopsworks/terraform-module-aws-ssm-session-management.git?ref=v1.0.0"
  }

  inputs = {
    org = {
      organization_name = "my-org"
      organization_unit = "shared"
      environment_type  = "production"
      environment_name  = "prod"
    }
    spoke_def = "001"
    is_hub    = false
    
    settings = {
      cloudwatch = {
        enabled   = true
        retention = 14
      }
      kms = {
        enabled = true
      }
    }
  }
  ```
  
  ### Variables Documentation (YAML format)
  ```yaml
  # Organization details
  org:                                              # (Required) Organization details
    organization_name: "example"                    # (Required) The name of the organization
    organization_unit: "devops"                     # (Required) The unit within the organization
    environment_type: "production"                  # (Required) The type of environment (e.g. production, staging)
    environment_name: "prod"                        # (Required) The name of the environment

  # Spoke ID Number
  spoke_def: "001"                                  # (Optional) Spoke ID Number, must be a 3 digit number. Default: "001"

  # Hub/Spoke configuration
  is_hub: false                                     # (Optional) Is this a hub or spoke configuration? Default: false

  # Extra tags
  extra_tags: {}                                    # (Optional) Extra tags to add to the resources. Default: {}

  # Settings for SSM Session Manager & SSM Fleet Manager
  settings:
    random_bucket_suffix: true                      # (Optional) Whether to add a random suffix to the S3 bucket name. Default: true
    allowed_iam_role_arns: []                       # (Optional) List of IAM role ARNs allowed to access the S3 bucket and KMS key. Default: []
    kms:                                            # (Optional) KMS configuration for encryption
      enabled: true                                 # (Optional) Whether to create a new KMS key. Default: true
      key_alias: ""                                 # (Optional) Existing KMS key alias to use if kms.enabled is false. Default: ""
      key_id: ""                                    # (Optional) Existing KMS key ID to use if kms.enabled is false. Default: ""
      deletion_window: 30                           # (Optional) Deletion window in days for the KMS key. Default: 30
      enable_key_rotation: true                     # (Optional) Whether to enable key rotation for the KMS key. Default: true
      rotation_period_in_days: 90                   # (Optional) Rotation period in days for the KMS key. Default: 90
      multi_region: false                           # (Optional) Whether the KMS key is multi-region. Default: false
      alias_name: "ssm-session-mgmt-key"            # (Optional) Alias name for the KMS key. Default: "ssm-session-mgmt-key-${local.system_name}"
    session:                                        # (Optional) Session Manager settings
      run_as: ""                                    # (Optional) The user to run as during the session. Default: ""
      timeout: 20                                   # (Optional) Idle session timeout in minutes. Default: 20
      max_duration: 60                              # (Optional) Maximum session duration in minutes. Default: 60
    audit:                                          # (Optional) Audit logs settings for S3
      transition_days: 30                           # (Optional) Number of days before transitioning logs to STANDARD_IA. Default: 30
      archive_days: 60                              # (Optional) Number of days before transitioning logs to GLACIER. Default: 60
      retention_years: 5                            # (Optional) Number of years to retain logs. Default: 5
    cloudwatch:                                     # (Optional) CloudWatch logging settings
      enabled: false                                # (Optional) Whether to enable CloudWatch logging. Default: false
      retention: 7                                  # (Optional) CloudWatch log retention in days. Default: 7
  ```

# Example usage
examples: |-
  ### Basic Usage
  ```hcl
  inputs = {
    org = {
      organization_name = "cloudopsworks"
      organization_unit = "it"
      environment_type  = "prod"
      environment_name  = "core"
    }
  }
  ```

  ### Advanced Usage with CloudWatch and Custom KMS
  ```hcl
  inputs = {
    org = {
      organization_name = "cloudopsworks"
      organization_unit = "it"
      environment_type  = "prod"
      environment_name  = "core"
    }
    settings = {
      cloudwatch = {
        enabled   = true
        retention = 30
      }
      kms = {
        enabled                 = true
        deletion_window         = 7
        rotation_period_in_days = 180
      }
      audit = {
        retention_years = 7
      }
    }
  }
  ```

# How to get started quickly
quickstart: |-
  1. Define your Terragrunt configuration.
  2. Provide the required `org` input.
  3. Run `terragrunt plan` to see the resources to be created.
  4. Run `terragrunt apply` to deploy the configuration.

include:
  - "docs/targets.md"
  - "docs/terraform.md"

contributors:
  - name: "Cristian Beraha"
    github: "berahac"